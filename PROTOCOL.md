# Femtolytics Protocol

The endpoint of the API will be dependent on which instance of femtolytics you are using. If you are using your own, check your project's `urls.py` file to see the root path for `femtolytics.api.urls`.

If you are using [femtolytics.com](https://femtolytics.com) then the endpoint will be `https://femtolytics.com/api/v1/`

Femtolytics uses two types of events, one is called `event` for internal events, the other is called `action` for user triggered action.

In general `event` should only be triggered by the library and not directly by the client of the library.


## Event

To register events with femtolytics, you need to `POST` to `https://femtolytics.com/api/v1/event` with the following JSON:

```json
{
    'events: [
        {
            'package': {
                'name': 'com.example.app',
                'version': '1.2.3',
                'build': '99',
            },
            'device': {
                'name': 'iPhone 11 Max',
                'physical': true,
                'os': '13.1.4',
            },
            'visitor_id': 'uuid',
            'event': {
                'type': '<type>',
                'time': '<ISO8601 Time>',
                'properties': {},
            }
        }
    ]
}
```

In this particular case, `type` needs to be one of the followings `VIEW`, `NEW_USER`, `CRASH`, `GOAL`, `DETACHED`, `RESUMED`, `INACTIVE`, `PAUSED`

`VIEW` represents a screen in the application, the properties cannot be null and should contain `view` as a key. For example:

```json
    'event': {
        'type': 'VIEW',
        'properties': {
            'view': 'HomePage'
        },
        'time': '<time>'
    }
```

`NEW_USER` should be triggered once when a new UUID is generated by the library. In which case properties should contain a `visitor_id` key.

```json
    'event': {
        'type': 'NEW_USER',
        'properties': {
            'visitor_id': '<uuid>'
        },
        'time': '<time>'
    }
```

`CRASH` is used for when the application encounters an unhandled exceptions or a crash, the properties should have an `exception` key and an optional `stack_trace`.

```json
    'event': {
        'type': 'CRASH',
        'properties': {
            'exception': 'Divide by zero',
            'strack_trace': 'Filename:Line:divide_by\nFilename:Line:button_clicked\n'
        },
        'time': '<time>'
    }
```

`GOAL` tracks custom goals for the application. The only required key in properties is `goal`, the rest can be provided by the application itself.

```json
    'event': {
        'type': 'GOAL',
        'properties': {
            'goal': 'Subscription',
            'price': 'USD9.99'
        },
        'time': '<time>'
    }
```

The other events are used for tracking the application lifecycle.

## Action
To register custom actions, simply POST to `https://femtolytics.com/api/v1/action` with a very simnilar JSON format:

```json
{
    'actions': [
        {
            'package': {
                'name': 'com.example.app',
                'version': '1.2.3',
                'build': '99',
            },
            'device': {
                'name': 'iPhone 11 Max',
                'physical': true,
                'os': '13.1.4',
            },
            'visitor_id': 'uuid',
            'action': {
                'type': '<type>',
                'time': '<ISO8601 Time>',
                'properties': {},
            }
        }
    ]
}
```
